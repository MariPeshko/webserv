events {
    worker_connections 1024;
}

http {
    include /usr/local/etc/nginx/mime.types;
    default_type application/octet-stream;

    server {
        listen 8083;
        server_name www.example.com example.com;

        client_max_body_size 2m;

        error_page 403 /error_pages/403.html;
        error_page 404 /error_pages/404.html;
        error_page 405 /error_pages/405.html;
        error_page 500 /error_pages/500.html;

        location = /error_pages/403.html {
            root /Users/ivanvernihora/Documents/GitHub/webserv/www;
            internal;
        }
        location = /error_pages/404.html {
            root /Users/ivanvernihora/Documents/GitHub/webserv/www;
            internal;
        }
        location = /error_pages/405.html {
            root /Users/ivanvernihora/Documents/GitHub/webserv/www;
            internal;
        }
        location = /error_pages/500.html {
            root /Users/ivanvernihora/Documents/GitHub/webserv/www;
            internal;
        }

        location / {
            limit_except GET HEAD {
                deny all;
            }
            root /Users/ivanvernihora/Documents/GitHub/webserv/www/web;
            index index.html index.htm;
            autoindex off;
        }

        location /favicon.ico {
            limit_except GET HEAD {
                deny all;
            }
            root /Users/ivanvernihora/Documents/GitHub/webserv/www/favicon;
            index 42_logo.svg;
            autoindex off;
        }

        location = /about {
            limit_except GET POST {
                deny all;
            }
            rewrite ^ /about.html last;
        }

        location /wrong-auto-index {
            limit_except GET POST {
                deny all;
            }
            root /Users/ivanvernihora/Documents/GitHub/webserv/www/web;
            autoindex off;
        }

        location /correct-auto-index {
            limit_except GET POST {
                deny all;
            }
            root /Users/ivanvernihora/Documents/GitHub/webserv/www/web/auto-index;
            autoindex on;
        }

        location /auto-index-off {
            limit_except GET POST {
                deny all;
            }
            root /Users/ivanvernihora/Documents/GitHub/webserv/www/web;
            autoindex off;
        }

        location /gallery {
            limit_except GET {
                deny all;
            }
            alias /Users/ivanvernihora/Documents/GitHub/webserv/www/gallery/;
            index gallery.html;
            autoindex off;
        }

        location /old-page {
            return 301 /new-page;
        }

        location /new-page {
            limit_except GET {
                deny all;
            }
            root /Users/ivanvernihora/Documents/GitHub/webserv/www/web;
            index new-page.html;
        }

        location /cgi-bin {
            limit_except GET POST {
                deny all;
            }
            root /Users/ivanvernihora/Documents/GitHub/webserv/www/example.com/scripts;
            index index.php;
            
            # CGI handling would require fastcgi_pass or similar in real nginx
            # Example for PHP:
            # location ~ \.php$ {
            #     fastcgi_pass 127.0.0.1:9000;
            #     fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
            #     include fastcgi_params;
            # }
        }
    }

    server {
        server_name youpi;
        listen 8084;

        index index.html;

        error_page 403 /error_pages/403.html;
        error_page 404 /error_pages/404.html;
        error_page 500 /error_pages/500.html;

        location = /error_pages/403.html {
            root /Users/ivanvernihora/Documents/GitHub/webserv/www;
            internal;
        }
        location = /error_pages/404.html {
            root /Users/ivanvernihora/Documents/GitHub/webserv/www;
            internal;
        }
        location = /error_pages/500.html {
            root /Users/ivanvernihora/Documents/GitHub/webserv/www;
            internal;
        }

        location / {
            limit_except GET {
                deny all;
            }
            return 301 /additional;
        }

        location /additional {
            limit_except GET {
                deny all;
            }
            root /Users/ivanvernihora/Documents/GitHub/webserv/www/web;
            index additional.html;
        }

        location /favicon.ico {
            limit_except GET {
                deny all;
            }
            root /Users/ivanvernihora/Documents/GitHub/webserv/www/favicon;
        }
    }
}

