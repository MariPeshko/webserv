<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Simple HTML Page</title>
	<style>
		:root {
			--bg: #f7fafc;
			--card: #ffffff;
			--accent: #2563eb;
			--text: #0f172a;
		}

		html,
		body {
			height: 100%;
			margin: 0;
			font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
			background: var(--bg);
			color: var(--text);
		}

		.container {
			max-width: 900px;
			margin: 3rem auto;
			padding: 1rem;
		}

		header {
			display: flex;
			align-items: center;
			justify-content: space-between;
			gap: 0.5rem;
		}

		nav a {
			margin-left: 0.75rem;
			text-decoration: none;
			color: var(--accent);
			font-weight: 600;
		}

		.hero {
			background: linear-gradient(180deg, rgba(37, 99, 235, 0.06), transparent);
			border-radius: 12px;
			padding: 2rem;
			box-shadow: 0 6px 18px rgba(2, 6, 23, 0.06);
		}

		.hero h1 {
			margin: 0 0 .5rem 0;
			font-size: 1.6rem;
		}

		.hero p {
			margin: 0 0 1rem 0;
			color: #334155;
		}

		.btn {
			display: inline-block;
			background: var(--accent);
			color: white;
			padding: .1rem 1rem;
			border-radius: 8px;
			text-decoration: none;
			font-weight: 600;
		}

		section {
			margin-top: 1rem;
			background: var(--card);
			padding: 1rem;
			border-radius: 8px;
		}

		footer {
			margin-top: 2rem;
			text-align: center;
			color: #64748b;
			font-size: 0.9rem;
		}

		@media (max-width:560px) {
			.container {
				margin: 1.5rem;
				padding: .75rem;
			}

			header {
				flex-direction: column;
				align-items: flex-start;
				gap: .5rem;
			}
		}

		.image-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
			gap: 1rem;
		}

		.image-card {
			border: 1px solid #e2e8f0;
			border-radius: 8px;
			padding: 0.5rem;
			background: white;
			display: flex;
			flex-direction: column;
		}

		.image-card img {
			width: 100%;
			height: 150px;
			object-fit: contain;
			border-radius: 4px;
		}

		.delete-btn {
			background: #ef4444;
			margin-top: 0.5rem;
			width: 100%;
			font-size: 0.8rem;
			text-align: center;
			cursor: pointer;
			border-width: 1px ;
		}

		.delete-btn:hover {
			background: #dc2626;
		}
	</style>
</head>

<body>
	<div class="container">
		<header>
			<div>
				<strong>42 WebServer</strong>
				<div style="color:#475569;font-size:.9rem">A minimal starter page</div>
			</div>
			<nav aria-label="Main navigation">
				<a href="/">Home</a>
				<a href="/about">About</a>
				<a href="/additional">Additional</a>
			</nav>
		</header>

		<main>
			<section class="hero" aria-labelledby="hero-title">
				<h2 id="hero-title">Test POST and DELETE method</h2>
			</section>

		<section aria-labelledby="upload-title">
			<h3 id="upload-title">Upload a Picture</h3>
			<p>Select an image file to upload to the server.</p>
			<form class="upload-form" action="/uploaded_images/" method="post" enctype="multipart/form-data">
				<div class="file-input-wrapper">
					<input type="file" id="picture" name="picture" accept="image/*" class="file-input" required>
					<button type="button" class="btn" onclick="document.getElementById('picture').click()">
						Choose Picture
					</button>
				</div>
				<br><br>
				<button type="submit" class="btn">Upload Picture</button>
			</form>
		</section>

		<section aria-labelledby="gallery-title">
			<h3 id="gallery-title">Uploaded Images</h3>
			<div id="image-grid" class="image-grid">
				<!-- Images will be loaded here -->
			</div>
		</section>

		<section aria-labelledby="about-title">
			<h3 id="about-title">About this template</h3>
			<p>This file is intentionally small and dependency-free. Replace the content, add styles or scripts as
					needed.</p>
		</section>
	</main>

		<footer>
			© <span id="year"></span> MySite — Built with plain HTML
		</footer>
	</div>

	<script>
		// small script to update the year
        document.getElementById('year').textContent = new Date().getFullYear();

        // Show selected file name
        document.getElementById('picture').addEventListener('change', function(e) {
            const fileName = e.target.files[0] ? e.target.files[0].name : 'No file selected';
            console.log('Selected file:', fileName);
        });

		async function loadImages() {
            const grid = document.getElementById('image-grid');
            grid.innerHTML = '<p>Loading...</p>';

            try {
                const response = await fetch('/uploaded_images/');
                if (!response.ok) throw new Error('Failed to load images');

                const text = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, 'text/html');
                const links = Array.from(doc.querySelectorAll('a'));

                grid.innerHTML = '';

                const imageFiles = links
                    .map(link => link.getAttribute('href'))
                    .filter(href => href && !href.startsWith('.') && !href.startsWith('/'))
                    .filter(href => /\.(jpg|jpeg|png|gif|webp)$/i.test(href));

                if (imageFiles.length === 0) {
                    grid.innerHTML = '<p>No images found.</p>';
                    return;
                }

                imageFiles.forEach(fileName => {
					console.log("fileName", fileName)
                    const div = document.createElement('div');
                    div.className = 'image-card';

                    const img = document.createElement('img');
                    img.src = '/uploaded_images/' + fileName;

                    const btn = document.createElement('button');
                    btn.textContent = 'Delete';
                    btn.className = 'btn delete-btn';
                    btn.onclick = () => deleteImage(fileName, div);

                    div.appendChild(img);
                    div.appendChild(btn);
                    grid.appendChild(div);
                });
            } catch (err) {
                console.error(err);
                grid.innerHTML = '<p>Error loading images. Make sure autoindex is on for /uploaded_images/.</p>';
            }
        }

        async function deleteImage(fileName, element) {
            try {
                const response = await fetch('/uploaded_images/' + fileName, {
                    method: 'DELETE'
                });
				console.log(response, "response")
                if (response.ok) {
                    element.remove();
                } else {
                    alert('Failed to delete image');
                }
            } catch (err) {
                console.error(err);
                alert('Error deleting image');
            }
        }

        // Load images on startup
        loadImages();
	</script>
</body>

</html>
